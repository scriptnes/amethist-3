<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta content="width=device-width,initial-scale=1,minimal-ui" name="viewport">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,400italic|Material+Icons">
    <link rel="stylesheet" href="https://unpkg.com/vue-material@beta/dist/vue-material.min.css">
    <link rel="stylesheet" href="https://unpkg.com/vue-material@beta/dist/theme/default.css">
    <title>Amethist Menu Demo</title>
    <script src="https://unpkg.com/vue"></script>
    <script src="https://unpkg.com/vue-material@beta"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.js" integrity="sha256-fNXJFIlca05BIO2Y5zh1xrShK3ME+/lYZ0j+ChxX2DA="
        crossorigin="anonymous"></script>
</head>

<body>
    <!-- demo root element -->
    <div id="demo">
        <div class="md-layout md-gutter md-alignment-center-center">
            <md-toolbar class="md-primary md-dense" :md-elevation="0" style="overflow: hidden;position: fixed;top: 0;width: 100%;">
                <span class="md-title md-layout md-gutter md-alignment-center-center">Обедно меню: {{ currDay(dayNow) }} {{ dateNow }}</span>
            </md-toolbar>
            <br>
            <br>
            <md-app>
                <md-app-content id="wrapped" style="max-width:600px;">
                    <md-card v-for="(article,index) in filteredArticles" :key="index" v-on:click.native="toggleActive(article)" md-with-hover>
                        <img v-bind:src="article.gsx$image.$t" />
                        <md-card-header>
                            <div class="md-title">
                                <span>{{ capitalizeFirstLetter(article.gsx$title.$t) }}</span>
                            </div>
                        </md-card-header>

                        <md-card-content>
                            <p>Състав: {{ capitalizeFirstLetter(article.gsx$description.$t) }}</p>
                            <p>Грамаж: {{ article.gsx$weigth.$t }} гр.</p>
                            <p>Цена: {{ article.gsx$price.$t }} лв.</p>
                        </md-card-content>
                    </md-card>

                </md-app-content>
            </md-app>

        </div>

    </div>

    <script>
        Vue.use(VueMaterial.default);

        Vue.filter('currency', function (value) {
            return '$' + value.toFixed(2);
        });

        new Vue({
            el: '#demo',
            data: {
                searchString: "",
                articles: [],
                reservedArticles: [],
                showDialog: false,
                dateNow: new Date().toLocaleDateString(),
                dayNow: new Date().getDay(),

                test: [],
                imageIds: [],
            },

            methods: {

                toggleActive: function (s) {
                    s.gsx$active.$t = !s.gsx$active.$t;
                },
                preview: function () {
                    let self = this;
                    let count = 0;
                    this.articles.forEach(function (a) {
                        if (Boolean(a.gsx$active.$t) === false) {
                            self.reservedArticles.push(a);
                            count++;
                        }
                    });
                    console.log(count);
                    this.showDialog = true;

                },
                getJSON: function () {
                    let self = this;
                    let url = 'https://spreadsheets.google.com/feeds/list/1TT8WptUe8XEHdta4yp-zG0JGdXpwE4h-3VVc0Pfg8yY/od6/public/values?alt=json';
                    axios.get(url).then(response => {
                        self.articles = response.data.feed.entry
                    });
                },
                currDay(cDay) {
                    let c_day = ['Неделя', 'Понеделник', 'Вторник', 'Сряда', 'Четвъртък', 'Петък', 'Събота'];
                    return c_day[cDay];
                },
                capitalizeFirstLetter: function (s) {
                    return s[0].toUpperCase() + s.slice(1);
                },

            },

            created() {
                this.getJSON();
            },

            computed: {
                filteredArticles: function () {
                    let articles_array = this.articles;
                    let searchString = this.searchString;

                    if (!searchString) {
                        return articles_array;
                    }

                    searchString = searchString.trim().toLowerCase();

                    articles_array = articles_array.filter(function (item) {
                        if (item.gsx$title.$t.toLowerCase().indexOf(searchString) !== -1) {
                            return item;
                        }
                    })

                    // Return an array with the filtered data.
                    return articles_array;
                }
            }

        })
    </script>



    <style>
    </style>
</body>

</html>